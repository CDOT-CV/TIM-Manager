groups:
- name: service
  rules:
  #- alert: monitor_service_down
  # expr: up == 0
  # for: 30s
  # labels:
  #   severity: critical
  # annotations:
  #   summary: "Monitor service is down"
  #   description: "Service {{ $labels.instance }} is down."

  # Alert for any instance that is unreachable for >30s.
  - alert: instance_down
    expr: up == 0
    for: 30s
    labels:
      severity: critical
    annotations:
      summary: "Instance {{ $labels.instance }} down"
      description: "{{ $labels.instance }} of job {{ $labels.job }} is down."

- name: host
  rules:
  - alert: high_cpu_load
    expr: node_load1 > 12
    for: 1m
    labels:
      severity: warning
    annotations:
      summary: "Server under high load"
      description: "Docker host is under high load, the avg load 1m is at {{ $value}}. Reported by instance {{ $labels.instance }} of job {{ $labels.job }}."

  - alert: high_memory_load
    expr: (sum(node_memory_MemTotal_bytes) - sum(node_memory_MemFree_bytes + node_memory_Buffers_bytes + node_memory_Cached_bytes)) / sum(node_memory_MemTotal_bytes) * 100 > 85 
    for: 30s
    labels:
      severity: critical
    annotations:
      summary: "Server memory is almost full"
      description: "Docker host memory usage is {{ humanize $value}}%. Reported by instance {{ $labels.instance }} of job {{ $labels.job }}."

  - alert: high_storage_load
    expr: (node_filesystem_size_bytes{mountpoint="/etc/hosts"} - node_filesystem_free_bytes{mountpoint="/etc/hosts"}) / node_filesystem_size_bytes{mountpoint="/etc/hosts"} * 100 > 85 
    for: 30s
    labels:
      severity: critical
    annotations:
      summary: "Server storage is almost full"
      description: "Docker host storage usage is {{ humanize $value}}%. Reported by instance {{ $labels.instance }} of job {{ $labels.job }}."


- name: containers
  rules:
  - alert: ode_wrapper_down
    expr: absent(container_memory_usage_bytes{name="wyocvapplications_ode_wrapper_1"})
    for: 30s
    labels:
      severity: critical
    annotations:
      summary: "ode_wrapper is down"
      description: "Docker container wyocvapplications_ode_wrapper is down."

  - alert: dn_trac_sender_down
    expr: absent(container_memory_usage_bytes{name="wyocvapplications_dn_trac_sender_1"})
    for: 30s
    labels:
      severity: critical
    annotations:
      summary: "dn_trac_sender is down"
      description: "docker container wyocvapplications_dn_trac_sender is down."

  - alert: tim_logger_down
    expr: absent(container_memory_usage_bytes{name="wyocvapplications_tim_logger_1"})
    for: 30s
    labels:
      severity: critical
    annotations:
      summary: "tim_logger is down"
      description: "Docker container wyocvapplications_tim_logger_1 is down."

  - alert: angular_down
    expr: absent(container_memory_usage_bytes{name="wyocvapplications_angular_1"})
    for: 30s
    labels:
      severity: critical
    annotations:
      summary: "angular is down"
      description: "Docker container wyocvapplications_angular_1 is down."

  - alert: cv-data-tasks_down
    expr: absent(container_memory_usage_bytes{name="wyocvapplications_cv-data-tasks_1"})
    for: 30s
    labels:
      severity: critical
    annotations:
      summary: "cv-data-tasks is down"
      description: "Docker container wyocvapplications_cv-data-tasks_1 is down."

  - alert: cv-data-controller_down
    expr: absent(container_memory_usage_bytes{name="wyocvapplications_cv-data-controller_1"})
    for: 30s
    labels:
      severity: critical
    annotations:
      summary: "cv-data-controller is down"
      description: "Docker container  wyocvapplications_cv-data-controller_1 is down."

  - alert: bsm_logger_down
    expr: absent(container_memory_usage_bytes{name="wyocvapplications_bsm_logger_1"})
    for: 30s
    labels:
      severity: critical
    annotations:
      summary: "bsm_logger is down"
      description: "Docker container wyocvapplications_bsm_logger_1 is down."

  - alert: broadcast_tim_logger_down
    expr: absent(container_memory_usage_bytes{name="wyocvapplications_broadcast_tim_logger_1"})
    for: 30s
    labels:
      severity: critical
    annotations:
      summary: "broadcast_tim_logger is down"
      description: "Docker container wyocvapplications_broadcase_tim_logger_1 is down."

  - alert: da_logger_down
    expr: absent(container_memory_usage_bytes{name="wyocvapplications_da_logger_1"})
    for: 30s
    labels:
      severity: critical
    annotations:
      summary: "da_logger is down"
      description: "Docker container wyocvapplications_da_logger_1 is down."

  - alert: jpoode_cvpep_down
    expr: absent(container_memory_usage_bytes{name="jpoode_cvpep_bsm_depositor_1"})
    for: 30s
    labels:
      severity: critical
    annotations:
      summary: "jpoode_cvpep_bsm is down"
      description: "Docker container jpoode_cvpep_bsm is down."

  - alert: jpoode_rde_bsm_down
    expr: absent(container_memory_usage_bytes{name="jpoode_rde_bsm_depositor_1"})
    for: 30s
    labels:
      severity: critical
    annotations:
      summary: "jpoode_rde_bsm is down"
      description: "Docker container jpoode_rde_bsm_depositor is down."

  - alert: jpoode_rde_tim_down
    expr: absent(container_memory_usage_bytes{name="jpoode_rde_tim_depositor_1"})
    for: 30s
    labels:
      severity: critical
    annotations:
      summary: "jpoode_rde_tim is down"
      description: "Docker container jpoode_rde_tim_depositor is down."

  - alert: jpoode_ode
    expr: absent(container_memory_usage_bytes{name="jpoode_ode_1"})
    for: 30s
    labels:
      severity: critical
    annotations:
      summary: "jpoode_ode is down"
      description: "Docker container jpoode_ode_1 is down."

  - alert: jpoode_cvpep_bsm_down
    expr: absent(container_memory_usage_bytes{name="jpoode_cvpep_bsm_depositor_1"})
    for: 30s
    labels:
      severity: critical
    annotations:
      summary: "jpoode_cvpep_bsm is down"
      description: "Docker container jpoode_cvpep_bsm_depositor is down."

  - alert: jpoode_adm
    expr: absent(container_memory_usage_bytes{name="jpoode_adm_1"})
    for: 30s
    labels:
      severity: critical
    annotations:
      summary: "jpoode_adm is down"
      description: "Docker container jpoode_adm_1 is down."

  - alert: jpoode_aem
    expr: absent(container_memory_usage_bytes{name="jpoode_aem_1"})
    for: 30s
    labels:
      severity: critical
    annotations:
      summary: "jpoode_aem is down"
      description: "Docker container jpoode_aem_1 is down."

  - alert: jpoode_ppm_bsm_down
    expr: absent(container_memory_usage_bytes{name="jpoode_ppm_bsm_1"})
    for: 30s
    labels:
      severity: critical
    annotations:
      summary: "jpoode_ppm_bsm is down"
      description: "Docker container jpoode_ppm_bsm is down."

  - alert: jpoode_kafka_down
    expr: absent(container_memory_usage_bytes{name="jpoode_kafka_1"})
    for: 30s
    labels:
      severity: critical
    annotations:
      summary: "jpoode_kafka is down"
      description: "Docker container jpoode_kafka is down."

  - alert: jpoode_zookeeper_down
    expr: absent(container_memory_usage_bytes{name="jpoode_zookeeper_1"})
    for: 30s
    labels:
      severity: critical
    annotations:
      summary: "jpoode_zookeeper is down"
 
  - alert: smdm_down
    expr: absent(container_memory_usage_bytes{name="wyocvapplications_smdm_1"})
    for: 30s
    labels:
      severity: critical
    annotations:
      summary: "wyocvapplications_smdm_1 is down"

