groups:
- name: service
  rules:
  #- alert: monitor_service_down
  # expr: up == 0
  # for: 30s
  # labels:
  #   severity: critical
  # annotations:
  #   summary: "Monitor service is down"
  #   description: "Service {{ $labels.instance }} is down."

  # Alert for any instance that is unreachable for >30s.
  - alert: instance_down
    expr: up == 0
    for: 30s
    labels:
      severity: critical
    annotations:
      summary: "Instance {{ $labels.instance }} down"
      description: "{{ $labels.instance }} of job {{ $labels.job }} is down."

- name: host
  rules:
  - alert: high_cpu_load
    expr: node_load1 > 12
    for: 1m
    labels:
      severity: warning
    annotations:
      summary: "Server under high load"
      description: "Docker host is under high load, the avg load 1m is at {{ $value}}. Reported by instance {{ $labels.instance }} of job {{ $labels.job }}."

  - alert: high_memory_load
    expr: glances_mem-percent > 75 
    for: 30s
    labels:
      severity: critical
    annotations:
      summary: "Server memory is almost full"
      description: "Docker host memory usage is {{ humanize $value}}%. Reported by instance {{ $labels.instance }} of job {{ $labels.job }}."

  - alert: high_storage_load
    expr: glances_fs__rootfs_percent > 75 
    for: 30s
    labels:
      severity: critical
    annotations:
      summary: "Server storage is almost full"
      description: "Docker host storage usage is {{ humanize $value}}%. Reported by instance {{ $labels.instance }} of job {{ $labels.job }}."


- name: containers
  rules:
  - alert: ode_wrapper_down
    expr: rate(glances_docker_wyocv-ode_wrapper-1_networktime_since_update[5m]) == 0
    for: 30s
    labels:
      severity: critical
    annotations:
      summary: "ode_wrapper is down"
      description: "Docker container wyocv-ode_wrapper-1 is down."

  - alert: dn_trac_sender_down
    expr: rate(glances_docker_wyocv-dn_trac_sender-1_networktime_since_update[5m]) == 0
    for: 30s
    labels:
      severity: critical
    annotations:
      summary: "dn_trac_sender is down"
      description: "docker container wyocv-dn_trac_sender-1 is down."

  - alert: tim_logger_down
    expr: rate(glances_docker_wyocv-tim_logger-1_networktime_since_update[5m]) == 0
    for: 30s
    labels:
      severity: critical
    annotations:
      summary: "tim_logger is down"
      description: "Docker container wyocv-tim_logger-1 is down."

  - alert: angular_down
    expr: rate(glances_docker_wyocv-angular-1_networktime_since_update[5m]) == 0
    for: 30s
    labels:
      severity: critical
    annotations:
      summary: "angular is down"
      description: "Docker container wyocv-angular-1 is down."

  - alert: cv-data-tasks_down
    expr: rate(glances_docker_wyocv-cv-data-tasks-1_networktime_since_update[5m]) == 0
    for: 30s
    labels:
      severity: critical
    annotations:
      summary: "cv-data-tasks is down"
      description: "Docker container wyocv-cv-data-tasks-1 is down."

  - alert: cv-data-controller_down
    expr: rate(glances_docker_wyocv-cv-data-controller-1_networktime_since_update[5m]) == 0
    for: 30s
    labels:
      severity: critical
    annotations:
      summary: "cv-data-controller is down"
      description: "Docker container  wyocv-cv-data-controller-1 is down."

  - alert: bsm_logger_down
    expr: rate(glances_docker_wyocv-bsm_logger_mongo-1_networktime_since_update[5m]) == 0
    for: 30s
    labels:
      severity: critical
    annotations:
      summary: "bsm_logger is down"
      description: "Docker container wyocv-bsm_logger__mongo-1 is down."

  - alert: driveralert_logger_down
    expr: rate(glances_docker_wyocv-driveralert_logger_mongo-1_networktime_since_update[5m]) == 0
    for: 30s
    labels:
      severity: critical
    annotations:
      summary: "driveralert_logger is down"
      description: "Docker container wyocv-driveralert_logger_mongo-1 is down."

  - alert: ode-ode-1_down
    expr: rate(glances_docker_ode-ode-1_networktime_since_update[5m]) == 0
    for: 30s
    labels:
      severity: critical
    annotations:
      summary: "ode-ode-1 is down"
      description: "Docker container ode-ode-1 is down."

  - alert: ode-adm
    expr: rate(glances_docker_ode-adm-1_networktime_since_update[5m]) == 0
    for: 30s
    labels:
      severity: critical
    annotations:
      summary: "ode-adm is down"
      description: "Docker container ode-adm-1 is down."

  - alert: ode-aem
    expr: rate(glances_docker_ode-aem-1_networktime_since_update[5m]) == 0
    for: 30s
    labels:
      severity: critical
    annotations:
      summary: "ode-aem is down"
      description: "Docker container ode-aem-1 is down."

  - alert: ode-ppm_bsm_down
    expr: rate(glances_docker_ode-ppm_bsm-1_networktime_since_update[5m]) == 0
    for: 30s
    labels:
      severity: critical
    annotations:
      summary: "ode-ppm_bsm is down"
      description: "Docker container ode-ppm_bsm-1 is down."

  - alert: ode-kafka_down
    expr: rate(glances_docker_ode-kafka-1_networktime_since_update[5m]) == 0
    for: 30s
    labels:
      severity: critical
    annotations:
      summary: "ode-kafka is down"
      description: "Docker container ode-kafka-1 is down."

  - alert: ode-zookeeper_down
    expr: rate(glances_docker_ode-zookeeper-1_networktime_since_update[5m]) == 0
    for: 30s
    labels:
      severity: critical
    annotations:
      summary: "ode-zookeeper is down"
      description: "ode-zookeeper-1 is down"

  - alert: ode-sdw_depositor-1_down
    expr: rate(glances_docker_ode-sdw_depositor-1_networktime_since_update[5m]) == 0
    for: 30s
    labels:
      severity: critical
    annotations:
      summary: "ode-sdw_depositor-1 is down"
      description: "ode-sdw_depositor-1 is down"

  - alert: ode-sec-1_down
    expr: rate(glances_docker_ode-sec-1_networktime_since_update[5m]) == 0
    for: 30s
    labels:
      severity: critical
    annotations:
      summary: "ode-sec-1 is down"
      description: "ode-sec-1 is down"

  - alert: wyocv-cert-expiration-1_down
    expr: rate(glances_docker_wyocv-cert-expiration-1_networktime_since_update[5m]) == 0
    for: 30s
    labels:
      severity: critical
    annotations:
      summary: "wyocv-cert-expiration-1 is down"
      description: "wyocv-cert-expiration-1 is down"

  - alert: wyocv-logger-kafka-consumer-1_down
    expr: rate(glances_docker_wyocv-logger-kafka-consumer-1_networktime_since_update[5m]) == 0
    for: 30s
    labels:
      severity: critical
    annotations:
      summary: "wyocv-logger-kafka-consumer-1 is down"
      description: "wyocv-logger-kafka-consumer-1 is down"

  - alert: wyocv-milepost-graph-db-1_down
    expr: rate(glances_docker_wyocv-milepost-graph-db-1_networktime_since_update[5m]) == 0
    for: 30s
    labels:
      severity: critical
    annotations:
      summary: "wyocv-milepost-graph-db-1 is down"
      description: "wyocv-milepost-graph-db-1 is down"

  - alert: wyocv-rsu-data-controller-1_down
    expr: rate(glances_docker_wyocv-rsu-data-controller-1_networktime_since_update[5m]) == 0
    for: 30s
    labels:
      severity: critical
    annotations:
      summary: "wyocv-rsu-data-controller-1 is down"
      description: "wyocv-rsu-data-controller-1 is down"

  - alert: wyocv-tim-refresh-1_down
    expr: rate(glances_docker_wyocv-tim-refresh-1_networktime_since_update[5m]) == 0
    for: 30s
    labels:
      severity: critical
    annotations:
      summary: "wyocv-tim-refresh-1 is down"
      description: "wyocv-tim-refresh-1 is down"

  - alert: wyocv-tim_logger_mongo-1_down
    expr: rate(glances_docker_wyocv-tim_logger_mongo-1_networktime_since_update[5m]) == 0
    for: 30s
    labels:
      severity: critical
    annotations:
      summary: "wyocv-tim_logger_mongo-1 is down"
      description: "wyocv-tim_logger_mongo-1 is down"

  - alert: jpo-cvmanager-cvmanager_api-1_down
    expr: rate(glances_docker_jpo-cvmanager-cvmanager_networktime_since_update[5m]) == 0
    for: 30s
    labels:
      severity: critical
    annotations:
      summary: "jpo-cvmanager-cvmanager is down"
      description: "jpo-cvmanager-cvmanager is down"

  - alert: jpo-cvmanager-cvmanager_keycloak-1_down
    expr: rate(glances_docker_jpo-cvmanager-cvmanager_keycloak-1_networktime_since_update[5m]) == 0
    for: 30s
    labels:
      severity: critical
    annotations:
      summary: "jpo-cvmanager-cvmanager_keycloak-1 is down"
      description: "jpo-cvmanager-cvmanager_keycloak-1 is down"

  - alert: jpo-cvmanager-cvmanager_postgres-1_down
    expr: rate(glances_docker_jpo-cvmanager-cvmanager_postgres-1_networktime_since_update[5m]) == 0
    for: 30s
    labels:
      severity: critical
    annotations:
      summary: "jpo-cvmanager-cvmanager_postgres-1 is down"
      description: "jpo-cvmanager-cvmanager_postgres-1 is down"

  - alert: jpo-cvmanager-cvmanager_webapp-1_down
    expr: rate(glances_docker_jpo-cvmanager-cvmanager_webapp-1_networktime_since_update[5m]) == 0
    for: 30s
    labels:
      severity: critical
    annotations:
      summary: "jpo-cvmanager-cvmanager_webapp-1 is down"
      description: "jpo-cvmanager-cvmanager_webapp-1 is down"

  - alert: jpo-cvmanager-firmware_manager-1_down
    expr: rate(glances_docker_jpo-cvmanager-firmware_manager-1_networktime_since_update[5m]) == 0
    for: 30s
    labels:
      severity: critical
    annotations:
      summary: "jpo-cvmanager-firmware_manager-1 is down"
      description: "jpo-cvmanager-firmware_manager-1 is down"

  - alert: jpo-cvmanager-jpo_bsm_query-1_down
    expr: rate(glances_docker_jpo-cvmanager-jpo_bsm_query-1_networktime_since_update[5m]) == 0
    for: 30s
    labels:
      severity: critical
    annotations:
      summary: "jpo-cvmanager-jpo_bsm_query-1 is down"
      description: "jpo-cvmanager-jpo_bsm_query-1 is down"
